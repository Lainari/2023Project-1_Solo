# 사용자 관리

## 사용자 전환
`su [username]`
- 아이디를 생략하면 관리자로 전환
  - 관리자의 경우 : 비밀번호 없이 전환
  - 그외 : 변경하고자 하는 아이디의 비밀번호를 입력
`exit` : su 이전의 아이디로 돌아온다
  - 중첩해서 su 를 할 수 있으며 중첩한 횟수만큼 exit로 돌아온다

```bash:사용자 전환
1. 관리자 계정으로 접속하려고 하고 root 로 접속하였는지 확인하는 명령어까지 작성하라
2. studentA 계정에 접속하려고 한다. 이때 사용하는 명령어는?

# 정답
# 1. su (접속 후) whoami (root 결과 확인)
# 2. su studentA
```

## 비밀번호 변경
`passwd [username]`
- 관리자가 초기화 할 때
  - user 지정
  - 최소 글자 지키지 않아도 초기화 가능
- 자신의 비밀번호를 입력할 때
  - `passwd` 만 입력
  - 현재 비밀번호 넣고 새 비밀번호 입력
  - 최소 글자 규칙 지켜야 함(5자 이상)

```bash:비밀번호 변경
1. 관리자로 접속한 뒤, studentA 의 비밀번호를 바꾸는 명령어를 작성하라
2. 현재 접속 중인 본인 계정의 비밀번호를 변경하는 명령어는?

# 정답
# 1. su (접속 후) passwd studentA
# 2. passwd
```

## 리눅스의 사용자
1. 관리자(root) 계정
- 모든 권한을 가진 특수한 계정

2. 시스템 계정
- 리눅스를 설치하거나 시스템 소프트웨어를 설치할 때 생성되는 계정
- 각 기능에 맞게 제한된 기능을 수행

3. 사용자 계정
- 실제 사용자를 위한 계정

## 사용자 정보 파일 /etc/passwd

### 전체 계정에 대한 리스트
> jinseok : x : 1000 : 1000 : jinseok : /home/jinseok : /bin/bash
`:` 로 각 파트별로 구분할 수 있다
1. user name : 로그인할 때의 아이디
2. password : 별도의 파일로 관리, x로 표기됨
3. user id(uid) : 로그인 아이디와 별도로 관리되는 숫자 아이디
4. group id(gid) : 그룹의 숫자 아이디
5. user full name : 사용자 실명 또는 연락처로 사용, 옵션 정보
6. home directory 주소
7. shell
  a. /bin/shell명 : 일반 사용자가 선택할 수 있는 shell 들
  b. /sbin/nologin : 쉘 로그인 불가능. 홈디렉토리 제공하지 않음
  c. /bin/false : 쉘 로그인 불가능, ftp 접근 불가능, shell, ssh 불가능 등 대부분 제약

```bash:사용자 정보 파일 /etc/passwd
1. 사용자 정보 파일의 절대 주소로 표현하면?
2. 다음 계정 정보를 보고 틀린 문항을 고른다면?
  - jinseok : x : 1000 : 1000 : jinseok : /home/jinseok : /bin/bash
  a. 해당 계정 유저 명은 'jinseok'이다.
  b. 해당 계정 유저의 비밀번호는 1000 로 표기되어 있다
  c. 해당 계정 유저의 uid와 gid는 각각 1000으로 지정되어 있다
  d. 해당 계정 유저의 홈 디렉터리는 /bin/bash 로 지정되어 있다
  e. 해당 계정 유저의 user full name 은 jinseok 이며, bash 쉘을 사용할 수 있다
3. 사용자 정보 파일 중 /sbin/nologin 과 /bin/false 의 공통점은?


# 정답
# 1. /etc/passwd
# 2. b, d
# 3. 쉘 로그인이 불가능하다는 점이다

```

## 비밀 번호 정보 파일 /etc/shadow
- 보안을 위해 ***root 계정만 내용을 볼 수 있음***
`username:$algorithm$salt$password::0:99999:7:::` ':'를 통해 역할을 구분한다
1. user name : 유저명
2. $algorithm
  a. $1  = MD5(사용금지)
  b. $2a = Blowfish
  c. $2y = Eksblowfish
  d. $5  = SHA-256
  e. $6  = SHA-512
3. $salt : 해시 함수에서 예측 불가능성을 높이기 위해 사용되는 임의의 문자열
4. $password
  a. *   : 비밀번호 없음. 로그인 불가
  b. !!  : 비밀번호 없음. 로그인 불가. 사용자가 생성만 하고 비밀번호를 할당하지 않아도 이 표시
  c. 빈칸 : 비밀번호가 없지만 로그인은 가능하다
5. :   = 마지막 비밀번호 변경 후 지난 날짜
6. :0  = 비밀 번호 변경 후 최소 사용일, 0이면 즉시 변경 가능
7. :99999 = 비밀번호 최대 사용 기간
8. :7 = 비밀 번호 만료 전 경고 일
9. : = 비활성화, 비밀번호가 만료 된 이후 비활성화 일. 이 기간내에 새로 설정해야함
10. : 계정 만료일, 만료되면 관리자가 비밀번호 초기화를 해주어야 사용가능

```bash:비밀 번호 정보 파일
1. 비밀 번호 정보 파일의 절대 주소 경로는?
2. 비밀 번호 정보 파일은 누구나 해당 내용을 볼 수 있다(O, X)
3. 다음 계정의 비밀번호 정보를 보고 틀린 문항을 고른다면?
  - `jinseok:$6$asdjBaj1491$sdfgklndasdk.a9::0:99999:7:::`
  a. username은 jinseok 이며 algorithm을 SHA-256을 사용하고 있다
  b. algorithm 이후에 salt 값과 password 가 정상적으로 기입되어 있다
  c. 만약 이 계정의 비밀번호를 변경하려면 99999일이 지나야 한다
  d. 비밀번호를 변경 후 99999일 동안 사용할 수 있고, 만료 7일 전에 경고 메시지가 온다
  e. 이 계정은 비밀번호가 만료된 이후 7일 된 계정이다
  f. 이 계정은 계정 만료일이 지난 상태다
4. 만일 비밀번호 란이 *, !!, 빈칸인 계정이 있을 때, 로그인 가능한 계정은?

# 정답
# 1. /etc/passwd
# 2. X, root 계정만 열람 가능
# 3. a(SHA-512 사용), c(즉시 변경가능), e(활성화 상태임), f(만료되지 않음)
# 4. 빈칸(!! 와 * 는 비번이 없고 로그인 불가능, 빈칸은 비번이 없어도 로그인 가능)

```

## 기본 설정 /etc/login.defs
- 로그인과 관련된 기본 설정 파일
1. 비밀번호 만료 및 길이에 대한 설정
  - PASS_MAX_DAYS : 비밀번호 사용 일수
  - PASS_MIN_DAYS : 비밀번호 변경 일수
  - PASS_MIN_LEN  : 최소 비밀번호 길이
  - PASS_WARN_AGE : 비밀번호 만료 경고 일

2. 시스템/사용자 아이디의 번호 설정
  - UID_MIN     : 사용자 아이디(uid)의 초기번호
  - UID_MAX     : 사용자 아이디(uid)의 최대번호
  - SYS_UID_MIN : 시스템 아이디의 초기번호
  - SYS_UID_MAX : 시스템 아이디의 최대번호

3. 시스템/사용자 그룹 아이디의 번호 설정
  - GID_MIN     : 사용자 그룹아이디(gid)의 초기번호
  - GID_MAX     : 사용자 그룹아이디(gid)의 최대번호
  - SYS_GID_MIN : 시스템 그룹아이디의 초기번호
  - SYS_GID_MAX : 시스템 그룹아이디의 최대번호

4. 비밀번호 암호화 알고리즘 설정
  - ENCRYPT_METHOD SHA512 : 알고리즘이 $6(SHA-512) 로 설정되어있음

```bash:기본 설정
1. 로그인과 관련된 기본 설정 파일의 절대경로는?
2. 로그인과 관련된 기본 설정 파일의 역할로 알맞지 않은 것은?
  a. 비밀번호 만료 및 길이에 대한 설정
  b. 시스템/사용자 아이디의 번호 설정
  c. 시스템/사용자 그룹명의 설정
  d. 비밀번호 암호화 알고리즘 설정

# 정답
# 1. /etc/login.defs
# 2. c (그룹 아이디 번호 설정을 담당)

```

## 그룹 정보 파일 /etc/group
- 시스템에 등록된 그룹 정보
- 리눅스에서 사용자는 ***반드시 1개 이상의 그룹에 소속되어야 한다***
  - 그룹이 명시되지 않으면, 사용자 아이디와 같은 이름의 그룹을 만들고 그 그룹에 등록된다
  - 따라서 설치 아이디는 해당 아이디와 같은 이름의 그룹에 속해있다
`group name : password : group number : group member`
1. group name : 그룹명
2. password : 그룹 비밀번호
  - gpasswd groupname 으로 설정, /etc/gshadow에 저장
3. group number : 그룹 번호
4. group member : 그룹 맴버
  - 이 그룹을 **부그룹**으로 사용하는 맴버명

```bash:그룹 정보 파일
1. 리눅스에서 시스템에 등록된 그룹 정보가 담긴 파일의 절대 주소는?
2. 리눅스에서 사용자는 1개 이상의 그룹에 소속되거나, 소속되지 않아도 된다(O, X)
3. 만약 그룹을 명시하지 않은채로 계정을 생성하면 해당 계정명과 같은 이름으로 그룹을 생성하고 그 그룹에 자동으로 속한다(O, X)
4. 다음 계정의 그룹 정보를 보고 틀린 문항을 고른다면?
  - `jinseok:x:1000:jinseok`
  a. 그룹명은 jinseok 이고, 비밀번호는 1000 이다
  b. 그룹번호는 1000 을 갖고 있으며 그룹 맴버로서 jinseok 이 있다


# 정답
# 1. /etc/group
# 2. X (무조건 1개 이상 소속되어야 한다)
# 3. O
# 4. a (비밀번호는 x로 감춰져있다)

```

# ⚠ 그룹, 사용자 관리(추가, 수정, 삭제)
> 많은 사용자를 만들 때는 **그룹을 먼저 만들고,** 사용자를 이후에 추가해준다!

## 그룹 관리
`groupadd [option] groupname`
- groupname 인 그룹을 추가한다
- `-g gid` 옵션을 통해 해당 그룹에게 그룹 아이디(숫자)를 지정해준다.
  - 이때 유일한 값을 사용해야 한다

`groupmod [option] groupname`
- groupname 인 그룹 정보를 수정하는 명령어
- `-n name` 옵션으로 그룹 이름을 name 으로 변경한다
- `-g gid`  옵션으로 그룹 아이디를 gid 로 변경한다

`groupdel groupname`
- groupname 인 그룹을 삭제한다
  - 해당 그룹에 소속된 사용자나 파일이 있을 경우 삭제 불가능!

`gpasswd [option] groupname`
- 그룹의 비밀번호를 설정한다
  - 그룹의 비밀번호는 /etc/gshadow 파일에 저장된다
- `-r`          옵션으로 그룹의 암호를 삭제한다
- `-a username` 옵션으로 username인 사용자를 그룹에 추가한다
- `-d username` 옵션으로 username인 사용자를 그룹에서 삭제한다

```bash:그룹 관리
1. 

# 정답
# 1. 
```